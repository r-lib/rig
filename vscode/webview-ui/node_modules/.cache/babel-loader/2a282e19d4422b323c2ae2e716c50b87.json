{"ast":null,"code":"import { AttachedBehaviorHTMLDirective, DOM, SubscriberSet } from \"@microsoft/fast-element\";\nconst observer = new MutationObserver(mutations => {\n  for (const mutation of mutations) {\n    AttributeReflectionSubscriptionSet.getOrCreateFor(mutation.target).notify(mutation.attributeName);\n  }\n});\n\nclass AttributeReflectionSubscriptionSet extends SubscriberSet {\n  constructor(source) {\n    super(source);\n    this.watchedAttributes = new Set();\n    AttributeReflectionSubscriptionSet.subscriberCache.set(source, this);\n  }\n\n  subscribe(subscriber) {\n    super.subscribe(subscriber);\n\n    if (!this.watchedAttributes.has(subscriber.attributes)) {\n      this.watchedAttributes.add(subscriber.attributes);\n      this.observe();\n    }\n  }\n\n  unsubscribe(subscriber) {\n    super.unsubscribe(subscriber);\n\n    if (this.watchedAttributes.has(subscriber.attributes)) {\n      this.watchedAttributes.delete(subscriber.attributes);\n      this.observe();\n    }\n  }\n\n  static getOrCreateFor(source) {\n    return this.subscriberCache.get(source) || new AttributeReflectionSubscriptionSet(source);\n  }\n\n  observe() {\n    const attributeFilter = [];\n\n    for (const attributes of this.watchedAttributes.values()) {\n      for (let i = 0; i < attributes.length; i++) {\n        attributeFilter.push(attributes[i]);\n      }\n    }\n\n    observer.observe(this.source, {\n      attributeFilter\n    });\n  }\n\n}\n\nAttributeReflectionSubscriptionSet.subscriberCache = new WeakMap();\n\nclass ReflectAttrBehavior {\n  constructor(target, attributes) {\n    this.target = target;\n    this.attributes = Object.freeze(attributes);\n  }\n\n  bind(source) {\n    AttributeReflectionSubscriptionSet.getOrCreateFor(source).subscribe(this); // Reflect any existing attributes because MutationObserver will only\n    // handle *changes* to attributes.\n\n    if (source.hasAttributes()) {\n      for (let i = 0; i < source.attributes.length; i++) {\n        this.handleChange(source, source.attributes[i].name);\n      }\n    }\n  }\n\n  unbind(source) {\n    AttributeReflectionSubscriptionSet.getOrCreateFor(source).unsubscribe(this);\n  }\n\n  handleChange(source, arg) {\n    // In cases where two or more ReflectAttrBehavior instances are bound to the same element,\n    // they will share a Subscriber implementation. In that case, this handle change can be invoked with\n    // attributes an instances doesn't need to reflect. This guards against reflecting attrs\n    // that shouldn't be reflected.\n    if (this.attributes.includes(arg)) {\n      DOM.setAttribute(this.target, arg, source.getAttribute(arg));\n    }\n  }\n\n}\n/**\n * Reflects attributes from the host element to the target element of the directive.\n * @param attributes - The attributes to reflect\n *\n * @beta\n * @example\n * ```ts\n * const template = html`\n *     <button\n *         ${reflectAttributes(\"aria-label\", \"aria-describedby\")}\n *     >\n *          hello world\n *     </button\n * `\n * ```\n */\n\n\nexport function reflectAttributes() {\n  for (var _len = arguments.length, attributes = new Array(_len), _key = 0; _key < _len; _key++) {\n    attributes[_key] = arguments[_key];\n  }\n\n  return new AttachedBehaviorHTMLDirective(\"fast-reflect-attr\", ReflectAttrBehavior, attributes);\n}","map":{"version":3,"names":["AttachedBehaviorHTMLDirective","DOM","SubscriberSet","observer","MutationObserver","mutations","mutation","AttributeReflectionSubscriptionSet","getOrCreateFor","target","notify","attributeName","constructor","source","watchedAttributes","Set","subscriberCache","set","subscribe","subscriber","has","attributes","add","observe","unsubscribe","delete","get","attributeFilter","values","i","length","push","WeakMap","ReflectAttrBehavior","Object","freeze","bind","hasAttributes","handleChange","name","unbind","arg","includes","setAttribute","getAttribute","reflectAttributes"],"sources":["/Users/gaborcsardi/works/rig/vscode/webview-ui/node_modules/@microsoft/fast-foundation/dist/esm/directives/reflect-attributes.js"],"sourcesContent":["import { AttachedBehaviorHTMLDirective, DOM, SubscriberSet, } from \"@microsoft/fast-element\";\nconst observer = new MutationObserver((mutations) => {\n    for (const mutation of mutations) {\n        AttributeReflectionSubscriptionSet.getOrCreateFor(mutation.target).notify(mutation.attributeName);\n    }\n});\nclass AttributeReflectionSubscriptionSet extends SubscriberSet {\n    constructor(source) {\n        super(source);\n        this.watchedAttributes = new Set();\n        AttributeReflectionSubscriptionSet.subscriberCache.set(source, this);\n    }\n    subscribe(subscriber) {\n        super.subscribe(subscriber);\n        if (!this.watchedAttributes.has(subscriber.attributes)) {\n            this.watchedAttributes.add(subscriber.attributes);\n            this.observe();\n        }\n    }\n    unsubscribe(subscriber) {\n        super.unsubscribe(subscriber);\n        if (this.watchedAttributes.has(subscriber.attributes)) {\n            this.watchedAttributes.delete(subscriber.attributes);\n            this.observe();\n        }\n    }\n    static getOrCreateFor(source) {\n        return (this.subscriberCache.get(source) ||\n            new AttributeReflectionSubscriptionSet(source));\n    }\n    observe() {\n        const attributeFilter = [];\n        for (const attributes of this.watchedAttributes.values()) {\n            for (let i = 0; i < attributes.length; i++) {\n                attributeFilter.push(attributes[i]);\n            }\n        }\n        observer.observe(this.source, { attributeFilter });\n    }\n}\nAttributeReflectionSubscriptionSet.subscriberCache = new WeakMap();\nclass ReflectAttrBehavior {\n    constructor(target, attributes) {\n        this.target = target;\n        this.attributes = Object.freeze(attributes);\n    }\n    bind(source) {\n        AttributeReflectionSubscriptionSet.getOrCreateFor(source).subscribe(this);\n        // Reflect any existing attributes because MutationObserver will only\n        // handle *changes* to attributes.\n        if (source.hasAttributes()) {\n            for (let i = 0; i < source.attributes.length; i++) {\n                this.handleChange(source, source.attributes[i].name);\n            }\n        }\n    }\n    unbind(source) {\n        AttributeReflectionSubscriptionSet.getOrCreateFor(source).unsubscribe(this);\n    }\n    handleChange(source, arg) {\n        // In cases where two or more ReflectAttrBehavior instances are bound to the same element,\n        // they will share a Subscriber implementation. In that case, this handle change can be invoked with\n        // attributes an instances doesn't need to reflect. This guards against reflecting attrs\n        // that shouldn't be reflected.\n        if (this.attributes.includes(arg)) {\n            DOM.setAttribute(this.target, arg, source.getAttribute(arg));\n        }\n    }\n}\n/**\n * Reflects attributes from the host element to the target element of the directive.\n * @param attributes - The attributes to reflect\n *\n * @beta\n * @example\n * ```ts\n * const template = html`\n *     <button\n *         ${reflectAttributes(\"aria-label\", \"aria-describedby\")}\n *     >\n *          hello world\n *     </button\n * `\n * ```\n */\nexport function reflectAttributes(...attributes) {\n    return new AttachedBehaviorHTMLDirective(\"fast-reflect-attr\", ReflectAttrBehavior, attributes);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}