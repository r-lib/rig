{"ast":null,"code":"import { DOM } from \"../dom.js\";\nimport { calcSplices, newSplice, projectArraySplices } from \"./array-change-records.js\";\nimport { SubscriberSet } from \"./notifier.js\";\nimport { Observable } from \"./observable.js\";\nlet arrayObservationEnabled = false;\n\nfunction adjustIndex(changeRecord, array) {\n  let index = changeRecord.index;\n  const arrayLength = array.length;\n\n  if (index > arrayLength) {\n    index = arrayLength - changeRecord.addedCount;\n  } else if (index < 0) {\n    index = arrayLength + changeRecord.removed.length + index - changeRecord.addedCount;\n  }\n\n  if (index < 0) {\n    index = 0;\n  }\n\n  changeRecord.index = index;\n  return changeRecord;\n}\n\nclass ArrayObserver extends SubscriberSet {\n  constructor(source) {\n    super(source);\n    this.oldCollection = void 0;\n    this.splices = void 0;\n    this.needsQueue = true;\n    this.call = this.flush;\n    Reflect.defineProperty(source, \"$fastController\", {\n      value: this,\n      enumerable: false\n    });\n  }\n\n  subscribe(subscriber) {\n    this.flush();\n    super.subscribe(subscriber);\n  }\n\n  addSplice(splice) {\n    if (this.splices === void 0) {\n      this.splices = [splice];\n    } else {\n      this.splices.push(splice);\n    }\n\n    if (this.needsQueue) {\n      this.needsQueue = false;\n      DOM.queueUpdate(this);\n    }\n  }\n\n  reset(oldCollection) {\n    this.oldCollection = oldCollection;\n\n    if (this.needsQueue) {\n      this.needsQueue = false;\n      DOM.queueUpdate(this);\n    }\n  }\n\n  flush() {\n    const splices = this.splices;\n    const oldCollection = this.oldCollection;\n\n    if (splices === void 0 && oldCollection === void 0) {\n      return;\n    }\n\n    this.needsQueue = true;\n    this.splices = void 0;\n    this.oldCollection = void 0;\n    const finalSplices = oldCollection === void 0 ? projectArraySplices(this.source, splices) : calcSplices(this.source, 0, this.source.length, oldCollection, 0, oldCollection.length);\n    this.notify(finalSplices);\n  }\n\n}\n/* eslint-disable prefer-rest-params */\n\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n\n/**\n * Enables the array observation mechanism.\n * @remarks\n * Array observation is enabled automatically when using the\n * {@link RepeatDirective}, so calling this API manually is\n * not typically necessary.\n * @public\n */\n\n\nexport function enableArrayObservation() {\n  if (arrayObservationEnabled) {\n    return;\n  }\n\n  arrayObservationEnabled = true;\n  Observable.setArrayObserverFactory(collection => {\n    return new ArrayObserver(collection);\n  });\n  const proto = Array.prototype; // Don't patch Array if it has already been patched\n  // by another copy of fast-element.\n\n  if (proto.$fastPatch) {\n    return;\n  }\n\n  Reflect.defineProperty(proto, \"$fastPatch\", {\n    value: 1,\n    enumerable: false\n  });\n  const pop = proto.pop;\n  const push = proto.push;\n  const reverse = proto.reverse;\n  const shift = proto.shift;\n  const sort = proto.sort;\n  const splice = proto.splice;\n  const unshift = proto.unshift;\n\n  proto.pop = function () {\n    const notEmpty = this.length > 0;\n    const methodCallResult = pop.apply(this, arguments);\n    const o = this.$fastController;\n\n    if (o !== void 0 && notEmpty) {\n      o.addSplice(newSplice(this.length, [methodCallResult], 0));\n    }\n\n    return methodCallResult;\n  };\n\n  proto.push = function () {\n    const methodCallResult = push.apply(this, arguments);\n    const o = this.$fastController;\n\n    if (o !== void 0) {\n      o.addSplice(adjustIndex(newSplice(this.length - arguments.length, [], arguments.length), this));\n    }\n\n    return methodCallResult;\n  };\n\n  proto.reverse = function () {\n    let oldArray;\n    const o = this.$fastController;\n\n    if (o !== void 0) {\n      o.flush();\n      oldArray = this.slice();\n    }\n\n    const methodCallResult = reverse.apply(this, arguments);\n\n    if (o !== void 0) {\n      o.reset(oldArray);\n    }\n\n    return methodCallResult;\n  };\n\n  proto.shift = function () {\n    const notEmpty = this.length > 0;\n    const methodCallResult = shift.apply(this, arguments);\n    const o = this.$fastController;\n\n    if (o !== void 0 && notEmpty) {\n      o.addSplice(newSplice(0, [methodCallResult], 0));\n    }\n\n    return methodCallResult;\n  };\n\n  proto.sort = function () {\n    let oldArray;\n    const o = this.$fastController;\n\n    if (o !== void 0) {\n      o.flush();\n      oldArray = this.slice();\n    }\n\n    const methodCallResult = sort.apply(this, arguments);\n\n    if (o !== void 0) {\n      o.reset(oldArray);\n    }\n\n    return methodCallResult;\n  };\n\n  proto.splice = function () {\n    const methodCallResult = splice.apply(this, arguments);\n    const o = this.$fastController;\n\n    if (o !== void 0) {\n      o.addSplice(adjustIndex(newSplice(+arguments[0], methodCallResult, arguments.length > 2 ? arguments.length - 2 : 0), this));\n    }\n\n    return methodCallResult;\n  };\n\n  proto.unshift = function () {\n    const methodCallResult = unshift.apply(this, arguments);\n    const o = this.$fastController;\n\n    if (o !== void 0) {\n      o.addSplice(adjustIndex(newSplice(0, [], arguments.length), this));\n    }\n\n    return methodCallResult;\n  };\n}\n/* eslint-enable prefer-rest-params */\n\n/* eslint-enable @typescript-eslint/explicit-function-return-type */","map":{"version":3,"names":["DOM","calcSplices","newSplice","projectArraySplices","SubscriberSet","Observable","arrayObservationEnabled","adjustIndex","changeRecord","array","index","arrayLength","length","addedCount","removed","ArrayObserver","constructor","source","oldCollection","splices","needsQueue","call","flush","Reflect","defineProperty","value","enumerable","subscribe","subscriber","addSplice","splice","push","queueUpdate","reset","finalSplices","notify","enableArrayObservation","setArrayObserverFactory","collection","proto","Array","prototype","$fastPatch","pop","reverse","shift","sort","unshift","notEmpty","methodCallResult","apply","arguments","o","$fastController","oldArray","slice"],"sources":["/Users/gaborcsardi/works/rig/vscode/webview-ui/node_modules/@microsoft/fast-element/dist/esm/observation/array-observer.js"],"sourcesContent":["import { DOM } from \"../dom.js\";\nimport { calcSplices, newSplice, projectArraySplices } from \"./array-change-records.js\";\nimport { SubscriberSet } from \"./notifier.js\";\nimport { Observable } from \"./observable.js\";\nlet arrayObservationEnabled = false;\nfunction adjustIndex(changeRecord, array) {\n    let index = changeRecord.index;\n    const arrayLength = array.length;\n    if (index > arrayLength) {\n        index = arrayLength - changeRecord.addedCount;\n    }\n    else if (index < 0) {\n        index =\n            arrayLength + changeRecord.removed.length + index - changeRecord.addedCount;\n    }\n    if (index < 0) {\n        index = 0;\n    }\n    changeRecord.index = index;\n    return changeRecord;\n}\nclass ArrayObserver extends SubscriberSet {\n    constructor(source) {\n        super(source);\n        this.oldCollection = void 0;\n        this.splices = void 0;\n        this.needsQueue = true;\n        this.call = this.flush;\n        Reflect.defineProperty(source, \"$fastController\", {\n            value: this,\n            enumerable: false,\n        });\n    }\n    subscribe(subscriber) {\n        this.flush();\n        super.subscribe(subscriber);\n    }\n    addSplice(splice) {\n        if (this.splices === void 0) {\n            this.splices = [splice];\n        }\n        else {\n            this.splices.push(splice);\n        }\n        if (this.needsQueue) {\n            this.needsQueue = false;\n            DOM.queueUpdate(this);\n        }\n    }\n    reset(oldCollection) {\n        this.oldCollection = oldCollection;\n        if (this.needsQueue) {\n            this.needsQueue = false;\n            DOM.queueUpdate(this);\n        }\n    }\n    flush() {\n        const splices = this.splices;\n        const oldCollection = this.oldCollection;\n        if (splices === void 0 && oldCollection === void 0) {\n            return;\n        }\n        this.needsQueue = true;\n        this.splices = void 0;\n        this.oldCollection = void 0;\n        const finalSplices = oldCollection === void 0\n            ? projectArraySplices(this.source, splices)\n            : calcSplices(this.source, 0, this.source.length, oldCollection, 0, oldCollection.length);\n        this.notify(finalSplices);\n    }\n}\n/* eslint-disable prefer-rest-params */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/**\n * Enables the array observation mechanism.\n * @remarks\n * Array observation is enabled automatically when using the\n * {@link RepeatDirective}, so calling this API manually is\n * not typically necessary.\n * @public\n */\nexport function enableArrayObservation() {\n    if (arrayObservationEnabled) {\n        return;\n    }\n    arrayObservationEnabled = true;\n    Observable.setArrayObserverFactory((collection) => {\n        return new ArrayObserver(collection);\n    });\n    const proto = Array.prototype;\n    // Don't patch Array if it has already been patched\n    // by another copy of fast-element.\n    if (proto.$fastPatch) {\n        return;\n    }\n    Reflect.defineProperty(proto, \"$fastPatch\", {\n        value: 1,\n        enumerable: false,\n    });\n    const pop = proto.pop;\n    const push = proto.push;\n    const reverse = proto.reverse;\n    const shift = proto.shift;\n    const sort = proto.sort;\n    const splice = proto.splice;\n    const unshift = proto.unshift;\n    proto.pop = function () {\n        const notEmpty = this.length > 0;\n        const methodCallResult = pop.apply(this, arguments);\n        const o = this.$fastController;\n        if (o !== void 0 && notEmpty) {\n            o.addSplice(newSplice(this.length, [methodCallResult], 0));\n        }\n        return methodCallResult;\n    };\n    proto.push = function () {\n        const methodCallResult = push.apply(this, arguments);\n        const o = this.$fastController;\n        if (o !== void 0) {\n            o.addSplice(adjustIndex(newSplice(this.length - arguments.length, [], arguments.length), this));\n        }\n        return methodCallResult;\n    };\n    proto.reverse = function () {\n        let oldArray;\n        const o = this.$fastController;\n        if (o !== void 0) {\n            o.flush();\n            oldArray = this.slice();\n        }\n        const methodCallResult = reverse.apply(this, arguments);\n        if (o !== void 0) {\n            o.reset(oldArray);\n        }\n        return methodCallResult;\n    };\n    proto.shift = function () {\n        const notEmpty = this.length > 0;\n        const methodCallResult = shift.apply(this, arguments);\n        const o = this.$fastController;\n        if (o !== void 0 && notEmpty) {\n            o.addSplice(newSplice(0, [methodCallResult], 0));\n        }\n        return methodCallResult;\n    };\n    proto.sort = function () {\n        let oldArray;\n        const o = this.$fastController;\n        if (o !== void 0) {\n            o.flush();\n            oldArray = this.slice();\n        }\n        const methodCallResult = sort.apply(this, arguments);\n        if (o !== void 0) {\n            o.reset(oldArray);\n        }\n        return methodCallResult;\n    };\n    proto.splice = function () {\n        const methodCallResult = splice.apply(this, arguments);\n        const o = this.$fastController;\n        if (o !== void 0) {\n            o.addSplice(adjustIndex(newSplice(+arguments[0], methodCallResult, arguments.length > 2 ? arguments.length - 2 : 0), this));\n        }\n        return methodCallResult;\n    };\n    proto.unshift = function () {\n        const methodCallResult = unshift.apply(this, arguments);\n        const o = this.$fastController;\n        if (o !== void 0) {\n            o.addSplice(adjustIndex(newSplice(0, [], arguments.length), this));\n        }\n        return methodCallResult;\n    };\n}\n/* eslint-enable prefer-rest-params */\n/* eslint-enable @typescript-eslint/explicit-function-return-type */\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}